From: Markus Koschany <apo@debian.org>
Date: Sat, 28 May 2016 03:13:41 +0000
Subject: CVE-2015-5351

Origin: https://svn.apache.org/viewvc?view=revision&revision=1720658
Origin: https://svn.apache.org/viewvc?view=revision&revision=1720660
---
 webapps/docs/changelog.xml               | 7 +++++++
 webapps/host-manager/WEB-INF/jsp/401.jsp | 1 +
 webapps/host-manager/WEB-INF/jsp/403.jsp | 1 +
 webapps/host-manager/WEB-INF/jsp/404.jsp | 3 ++-
 webapps/host-manager/index.jsp           | 4 ++--
 webapps/manager/WEB-INF/web.xml          | 1 -
 webapps/manager/index.jsp                | 4 ++--
 7 files changed, 15 insertions(+), 6 deletions(-)

diff --git a/webapps/docs/changelog.xml b/webapps/docs/changelog.xml
index cb4c914..92d5b3c 100644
--- a/webapps/docs/changelog.xml
+++ b/webapps/docs/changelog.xml
@@ -326,6 +326,13 @@
         Handle the unlikely case where different versions of a web application
         are deployed with different session settings. (markt)
       </fix>
+      <fix>
+        Don't create sessions unnecessarily in the Manager application. (markt)
+      </fix>
+      <fix>
+        Don't create sessions unnecessarily in the Host Manager application.
+        (markt)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="WebSocket">
diff --git a/webapps/host-manager/WEB-INF/jsp/401.jsp b/webapps/host-manager/WEB-INF/jsp/401.jsp
index 83c8c6f..047766b 100644
--- a/webapps/host-manager/WEB-INF/jsp/401.jsp
+++ b/webapps/host-manager/WEB-INF/jsp/401.jsp
@@ -14,6 +14,7 @@
   See the License for the specific language governing permissions and
   limitations under the License.
 --%>
+<%@ page session="false" trimDirectiveWhitespaces="true" %>
 <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 <html>
  <head>
diff --git a/webapps/host-manager/WEB-INF/jsp/403.jsp b/webapps/host-manager/WEB-INF/jsp/403.jsp
index 2dbb448..5eff6f0 100644
--- a/webapps/host-manager/WEB-INF/jsp/403.jsp
+++ b/webapps/host-manager/WEB-INF/jsp/403.jsp
@@ -14,6 +14,7 @@
   See the License for the specific language governing permissions and
   limitations under the License.
 --%>
+<%@ page session="false" trimDirectiveWhitespaces="true" %>
 <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 <html>
  <head>
diff --git a/webapps/host-manager/WEB-INF/jsp/404.jsp b/webapps/host-manager/WEB-INF/jsp/404.jsp
index d1b5b0b..9816df5 100644
--- a/webapps/host-manager/WEB-INF/jsp/404.jsp
+++ b/webapps/host-manager/WEB-INF/jsp/404.jsp
@@ -14,7 +14,8 @@
   See the License for the specific language governing permissions and
   limitations under the License.
 --%>
-<%@ page import="org.apache.catalina.util.RequestUtil" %>
+<%@ page import="org.apache.catalina.util.RequestUtil" session="false"
+         trimDirectiveWhitespaces="true" %>
 <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 <html>
  <head>
diff --git a/webapps/host-manager/index.jsp b/webapps/host-manager/index.jsp
index d4816e5..2806b76 100644
--- a/webapps/host-manager/index.jsp
+++ b/webapps/host-manager/index.jsp
@@ -14,5 +14,5 @@
   See the License for the specific language governing permissions and
   limitations under the License.
 --%>
-<% response.sendRedirect(response.encodeRedirectURL(request.getContextPath() +
-        "/html")); %>
\ No newline at end of file
+<%@ page session="false" trimDirectiveWhitespaces="true" %>
+<% response.sendRedirect(request.getContextPath() + "/html"); %>
\ No newline at end of file
diff --git a/webapps/manager/WEB-INF/web.xml b/webapps/manager/WEB-INF/web.xml
index 230199e..ef917e6 100644
--- a/webapps/manager/WEB-INF/web.xml
+++ b/webapps/manager/WEB-INF/web.xml
@@ -115,7 +115,6 @@
   <filter-mapping>
     <filter-name>CSRF</filter-name>
     <servlet-name>HTMLManager</servlet-name>
-    <servlet-name>jsp</servlet-name>
   </filter-mapping>
 
   <!-- Define a Security Constraint on this Application -->
diff --git a/webapps/manager/index.jsp b/webapps/manager/index.jsp
index d4816e5..ff4f47b 100644
--- a/webapps/manager/index.jsp
+++ b/webapps/manager/index.jsp
@@ -14,5 +14,5 @@
   See the License for the specific language governing permissions and
   limitations under the License.
 --%>
-<% response.sendRedirect(response.encodeRedirectURL(request.getContextPath() +
-        "/html")); %>
\ No newline at end of file
+<%@ page session="false" %>
+<% response.sendRedirect(request.getContextPath() + "/html"); %>
\ No newline at end of file
