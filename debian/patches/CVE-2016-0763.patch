From: Markus Koschany <apo@debian.org>
Date: Sat, 28 May 2016 15:46:37 +0200
Subject: CVE-2016-0763

Origin: https://svn.apache.org/viewvc?view=revision&revision=1725929
---
 java/org/apache/naming/factory/ResourceLinkFactory.java | 5 +++++
 webapps/docs/changelog.xml                              | 4 ++++
 2 files changed, 9 insertions(+)

diff --git a/java/org/apache/naming/factory/ResourceLinkFactory.java b/java/org/apache/naming/factory/ResourceLinkFactory.java
index 808192c..8a43e74 100644
--- a/java/org/apache/naming/factory/ResourceLinkFactory.java
+++ b/java/org/apache/naming/factory/ResourceLinkFactory.java
@@ -60,6 +60,11 @@ public class ResourceLinkFactory
      * @param newGlobalContext new global context value
      */
     public static void setGlobalContext(Context newGlobalContext) {
+        SecurityManager sm = System.getSecurityManager();
+        if (sm != null) {
+            sm.checkPermission(new RuntimePermission(
+                   ResourceLinkFactory.class.getName() + ".setGlobalContext"));
+        }
         globalContext = newGlobalContext;
     }
 
diff --git a/webapps/docs/changelog.xml b/webapps/docs/changelog.xml
index f075094..d18692c 100644
--- a/webapps/docs/changelog.xml
+++ b/webapps/docs/changelog.xml
@@ -337,6 +337,10 @@
         Add the <code>StatusManagerServlet</code> to the list of Servlets that
         can only be loaded by privileged applications. (markt)
       </fix>
+      <fix>
+        Protect initialization of <code>ResourceLinkFactory</code> when
+        running with a SecurityManager. (kkolinko)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="WebSocket">
